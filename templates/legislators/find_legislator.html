{% extends "base.html" %}
{% load staticfiles %}

{% block head %}
<script src='https://maps.googleapis.com/maps/api/js'></script>
<script src='{% static "js/gmaps.js" %}'></script>
<script>
$(document).ready(function() {
    var map = new GMaps({
            div: '#map',
            lat: {{ lat }},
            lng: {{ lng }},
            zoom: 10
        });

    map.removeMarkers();
    map.addMarker({
       lat: {{ lat }},
       lng: {{ lng }}
    });

    $('#enter_location').submit(function(e){
        e.preventDefault();
        GMaps.geocode({
            address: $('#address').val().trim(),
            callback: function(results, status){
                if ( status == 'OK' ){
                    var latlng = results[0].geometry.location,
                            lat = latlng.lat(),
                            lon = latlng.lng();
                    $.get('../get_latlon/', {
                        user: results.name,
                        lat: lat,
                        lon: lon,
                        address: address.value
                    }).always(function() {
                        location.reload();
                    });
                }
            }
        });
    });
});
</script>
{% endblock %}

{% block title %}Find Your Legislator{% endblock title %}
{% block subtitle %}Enter an address to find your Senator and Representative{% endblock subtitle %}

{% block content %}
<div class="row">
    <div id="map" style="margin-left:100px;"></div>
</div>

{% include "preferences/location_form.html" %}

{% endblock content %}
